# 介绍

本项目是一个纯前端网页工具，用于：
- 输入文稿, 以评测键盘和(双拼等)输入方案的效率, 并提供优化


## 来源
本项目基于[macroxue/shuangpin](https://github.com/macroxue/shuangpin)进行改进


## 设计理念

### 用“时间模型”模拟真实打字速度
构建了一个更贴近**人体工学**的模型：
- 不同手指灵活度不同：小指 < 无名指 < 中指 < 食指；
- 每次击键耗时 =（移动距离 + 按键深度）÷ 手指速度；
- _**关键优化**_：如果左右手交替打字，第二次击键的“移动时间”可以和第一次的“按键动作”重叠，只算按键时间，不算移动等待时间

### 输出结果：直接给出“等效打字速度”
对一份文本，计算总击键次数 ÷ 总耗时 → 得到一个“速度得分”。

>_例如：_
>- 微软双拼：122.4 分
>- 自定义方案：134.8 分

你可以理解为：
- 微软双拼 ≈ 每分钟打122字
- 自定义方案 ≈ 每分钟打135字

差距约12字/分钟，清晰可见！

### 强调：这是相对评分，因人而异
如果你打字慢（如只有高手的一半速度），那你的实际收益是：
- 微软：61 字/分
- 自定义：67 字/分

虽然绝对提升不大（+6字），但比例提升一样（约10%）。
所以：
- 对高手：提升明显（雪中送炭）
- 对新手：也有帮助（锦上添花）

## 改进原因

1. 原项目仅用于在已有键位中, 评测(全拼,双拼)布局
   受到qwerty, dvorak等键位的影响, 无法找到真正的"最佳"布局

2. 使用贪心算法, 效率较低
   并且对于乱序双拼不友好(难以找到乱序双拼的最优布局)







# 小白也看得懂的教程

## 打开网页

### 方法1(简单, 但缺少2个功能)

在**文件管理器**(小白可以理解为"此电脑")中, 双击打开 eval.html 文件
然后就会在默认浏览器中打开该网页


**注意:** 受浏览器安全策略(以文件形式打开的网页, 不能与本地文件交互)影响，会缺少两类功能：
- 自动读取 **default_text.txt** 作为默认文稿 (需要你手动复制文章, 除了麻烦点, 没有什么区别)
- 布局的保存与编辑

如果你只想临时试用、或者手动粘贴文稿做评测，用这个方法即可。


### 方法2(功能完整, 但需要运行python脚本)
(实际上很简单, 不会的可以问AI)

步骤：
1. 安装 Python (可问AI如何操作)

2. 在项目根目录下运行：
```bash
python local_server.py
```

3. 浏览器打开：
http://127.0.0.1:8000/eval.html











## 文章输入

本工具基于文章来评判输入方案的效率

![文章输入](<picture/文章输入.png>)
将文章粘贴到框中

*如果*使用"打开网页-方法2", 会自动读取 default_text.txt 作为默认文章





### 提供可用文章

在项目根目录的文件夹**测试文章**中, 提供了一些可用的文章

中文文章:
- **三体1~3.txt** (进行了去(重要角色)人名的简单处理)

英文文章:
- **The Three-Body Problem + little prim.txt**





## 模式选择

![模式选择](<picture/模式选择.png>)
1. 双拼
2. 声母模式
用于单独评估声母布局的模式
(不过使用过后发现, 有双拼模式足以, 该模式基本无用)

3. 全拼/英文
处理全拼/英语布局
对于英语布局, 需要输入英语文章


## 布局

![布局](<picture/布局.png>)
**第一个框: 声母框**
- 在里面输入声母
- 声母模式下, 声母框中有字母, 韵母框中没有字母

**第二个框: 韵母框**
- 在里面输入韵母
- 全拼/英文模式下, 声母框中没有字母, 韵母框中有字母





### 零声母

基于双拼的实现原理, 每个音节都必须有一个声母
因此, 当一个音节的声母为空时(如 a, ai, ang等不需要声母的音节), 就需要使用零声母

即, 用一个键来代替"不存在的声母"

目前有2种零声母处理方式:
1. 以一个键作为零声母
在声母框中, 输入数字"0", 该键代表"零声母"

>如 以A键作为零声母
>a == AA
>ang == AH (以小鹤举例, 小鹤中, ang == H)

微软双拼等 使用该方式

2. 以韵母首字母作为零声母
ang 的首字母为A, 则:
    ang == ah (以小鹤为例)


特殊: 对于双字母音节, 以全拼输入
如 ai == A I; an == A N



本人两个方法都尝试过, 推荐方法2, 虽然方法1看起来跟整齐, 但是使用上不如方法2

另外, 还有拼音加加使用的"方法2的缩减版(双字母音节不使用全拼)",
本人使用时发现, 对于自定义程度高的双拼方案, 容易出现:
an = AO (即 如果an == O, 结合方法2, 出现该情况)
这种容易混乱的组合, 故不推荐, 也没有实现



### 位置对调

点击每个键的字母, 可以选择一个字母进行对调: 该键的声母与韵母 和 被选键的声母与韵母 位置对调
声母框和韵母框前, 有"对调"按钮, 可以单独对调 声母 或 韵母

**注意:** 根据双拼的原理, aeiouv 声母和韵母不能单独对调(即 对调声母时, 韵母必须一并对调)


### 固定

每个键的右上角, 有一个**固定**按钮
点击后, 该键就会固定在当前位置, 不能对调


### 热力图

![热力图](<picture/布局(热力图).png>)
热力图展示了每个键的**点击频率**
颜色越浅, 表示点击频率越低
颜色越深, 表示点击频率越高

### 布局编辑

![布局编辑](<picture/布局编辑.png>)
我们可以通过该功能保存我们制作的布局
布局保存到工具文件夹中的**saved_layouts.json**

- 保存: 保存现布局
- 载入: 选择一个布局, 加载到当前布局
- 重命名: 选择一个布局, 对其重命名
- 删除: 选择一个布局, 删除它
+ 替换: 选择一个布局, 用现布局替换它
    - 撤回: 撤回最近的一次替换操作


## 得分

![得分](<picture/得分.png>)
显示当前布局的**得分**
可以简单理解为: 当前布局理论上的**打字速度(字/分钟)**
(中文的速度与英文的速度计算方式不同, 基准也不同)



## 重码提示

![重码提示](<picture/重码提示.png>)
如果一个按键组合, 对应多个音节, 会进行提示
如: LY == lin 和 ling



## 优化

![优化](<picture/优化.png>)

现有3种优化布局的方式(建议结合交替使用)

1. 贪心算法
可以理解为"目光短浅", 每次调整, 只选择能够加分的, 不允许扣分

点击"建议"按钮, 会根据当前布局, 给出多个能够加分的对调建议
点击一次, 即可进行对调

有3种模式:
1) 混合
2) 只声母
3) 只韵母

另外, 提供了"两步搜索"模式
允许第一步*扣分*


**注意:**
随着可优化的分数的**缩小**, 容易出现错误的对调建议(使用后布局得分下降)
所以我增加了筛选功能, 每次点击"建议"按钮, 会自动测试建议, 删除错误建议, 直到遇到第一个正确建议



2. 退火
自动化(尽量)搜索最优布局, 但是不够稳定, 容易出现初始布局(起点)相同, 但最终结果不同的情况
不能保证布局为最优, 最好多次使用, 取最大值

3. 禁忌
相比"退火", 更加稳定(终点相同的概率更大), 但是搜索速度较慢
同样推荐多次使用


其他详情, 可将鼠标悬停在相关文字上进行查看


## 数据统计

![数据统计](<picture/数据统计.png>)
展示了当前布局的击键数据统计

- 同手连击: 2次击键, 由同一只手的手指完成
- 同指连击: 2次击键, 由同一只手指完成
- 同手异指连击: 2次击键, 由同一只手的不同手指完成

+ 0,1,2 距离: 以上2次击键, 相隔0,1,2个键



# 关键文件
- **default_text.txt**：默认测试文章
- **saved_layouts.json**：已保存方案（由 **local_server.py** 读写）
- **char_*.txt / char_info.js / hanzi_pinyin.js**：评测所需的数据与映射表


# 常见问题

## 1）提示“未能读取 default_text.txt”

如果你是(方法1)双击打开 eval.html（file://），浏览器会阻止网页读取本地 txt。
请改用本地服务方式(方法2)打开：http://127.0.0.1:8000/eval.html

## 2）保存/编辑方案无效

保存功能依赖 local_server.py 提供的接口，并会写入 saved_layouts.json。
请改用本地服务方式(方法2)打开：http://127.0.0.1:8000/eval.html，并且运行目录是项目根目录。





# 未来
1) 优化"只动韵母"的便利性
2) 可能增加键位, 让更多符号参与布局的评估
3) ......

# 功能隐藏
由于本人不太需要Rime输入法等的相关文件, 故隐藏了"生产配置文件"的功能


## 上游项目信息

- 原项目名称：shuangpin
- 原项目仓库/主页：[macroxue/shuangpin](https://github.com/macroxue/shuangpin)
- 上游基准版本（commit）：[cd74b95](https://github.com/macroxue/shuangpin/commit/cd74b9505c6b4bf905466d6f7ecb6bcf10ab5caf)
- 原作者/原维护者：macroxue
- 原项目许可证：GNU General Public License v3（见本仓库 [LICENSE](./LICENSE)）

# 致谢
- 感谢 [macroxue/shuangpin](https://github.com/macroxue/shuangpin) 项目，本项目基于其进行改进

# License
- 本项目采用 GNU General Public License v3.0（GPL-3.0）开源许可，详见 [LICENSE](LICENSE)
